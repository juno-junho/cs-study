# 운영체제와 컴퓨터


### SW(SoftWare)
용어를 보다가 기본적으로 듣지 못했던 개념이라 작성해본다. 일반적으로 알고있는 우리 SW는 2가지로 크게 나눌 수 있다.
- 운영체제 (OS)
- 응용 프로그램 (Application)


## 운영체제의 역할, 구조

운영체제는 크게 보면 관리자의 입장이라고 볼 수 있다. 그것은 어떤 역할을 하는지 확인하면 알 수가 있다.

> - CPU 스케줄링과 프로세스 관리 : CPU 소유권을 어떤 프로세스에 할당할지, 프로세스의 생성과 삭제, 자원 할당 및 반환을 관리한다.
> - 메모리 관리 : 한정된 메모리를 어떤 프로세스에 얼만큼 할당해야 하는지 관리한다.
> - 디스크 파일 관리 : 디스크 파일을 어떠한 방법으로 보관할지 관리한다.
> - I/O 디바이스 관리 : I/O 디바이스인 마우스, 키보드와 컴퓨터 간에 데이터를 주고받는 것을 관리한다.


그러면 이런 식으로 이제 자원들을 관리해주고 효율적으로 진행할 수 있도록 도와주는 것이 운영체제라고 알 수 있었다.

### 운영체제의 목적

- 처리 능력 향상 : 일정 시간 내에 시스템이 처리하는 일의 양을 늘리는 것이다.
- 반환 시간 단축 : 시스템에 작업을 의뢰한 시간부터 처리가 완료될 때까지 걸리는 시간
- 사용 가능도 향상 : 시스템 자원을 사용할 필요가 있을때 즉시 사용 가능한 정도
- 신뢰도 향상 : 시스템이 주어진 문제를 정확하게 해결하는 정도

이런 목적이 있었기에 위와 같은 역할을 해줬던 것이 있었다.

대표적인 운영체제들로는 : `Windows`, `Mac`, `UNIX`, `LINUX`가 있다.

### 운영체제의 구조

책에서 보면 운영체제는 유저 프로그램, GUI, 시스템콜, 커널, 드라이버, 하드웨어 순으로 이루어져있는데 유저 프로그램과 하드웨어 사이에 있는 부분들이 운영체제를 지칭하는 부분이다.


책의 표현대로 보면 GUI만 있는 것처럼 보이지만 실제로는 저쪽은 GUI, CUI도 올 수 있다.

### 사용자 인터폐이스
>  - GUI(Graphic User Interface) : 사용자가 편리하게 사용할 수 있도록 입출력 등의 기능을 알기 쉬운 아이콘 같은 그래픽으로 나타낸 것이다.(Window,Mac) 
>  - CUI/CLI(Character User Interface, Command Line Interface) : 그래픽이 아닌 명령어로 처리하는 인터페이스.(DOS, bash, UNIX,LINUX)


### 커널이란?

> - 컴퓨터 과학에서 커널은 운영체제의 핵심 부분으로서, 운영 체제의 다른 부분 및 응용 프로그램수행에 필요한 여러가지 서비스를 제공한다.
    >  결론은 `운영체제의 중요한 부분`이다.

커널의 하는 역할 크게 3가지이다.

1. 보안 : 커널은 컴퓨터 하드웨어와 프로세스의 보안을 책임진다.
2. 자원관리 : 한정된 시스템 자원을 효율적으로 관리하여 프로그램의 실행을 원할하게 한다. 프로세스에 처리기를 할당하는 것을 `스케줄링`이라고 한다.
3. 추상화 : 운영체제의 복잡한 내부를 감추고 깔끔하고 일관성 있는 인터페이스를 하드웨어 제공하여 몇 가지 하드웨어 추상화들을 구현한다. ~~~


여기서 자원관리에 대해서 가장 많이 보게 되는데 컴퓨터의 자원이라는 것은, CPU, 메모리, 가상메모리, 키보드, 마우스 등등 추상적으로는 쓰레드, 패킷, 프로토콜, 테스크를 말한다.

간단하게 컴퓨터 내부의 거의 대부분의 자원인 것이다.

### 커널의 구성

커널이 하는 일은 크게 5가지
1. 프로세스 관리 : 프로세스에 CPU를 배분하고 작업에 필요한 제반 환경 제공
2. 메모리 관리 : 프로세스에 작업 공간을 배치하고 실제 메모리보다 큰 가상공간 제공
3. 파일 시스템 관리 : 데이터를 저장하고 접근할 수 있는 인터페이스 제공
4. 입출력 관리 : 필요한 입출력 서비스 제공
5. 프로세스 간 통신 관리 : 공동 작업을 위한 각 프로세스 간 통신 환경 지원

이렇게 일을 해주고 상당히 중요한 작업들을 하는 것을 볼 수 있다.

### 커널의 종류

- 단일형 구조 커널 : 초창기 운영체제 구조이다. 대표적으로 MS-DOS, VMS를 사용 쉽게 말해 프로그램에서 main()함수에 모든 기능을 구현한 것과 같다.
    - 장점 : 모듈 간의 통신 비용이 줄어들어 효율적인 운영이 가능하다.
    - 단점
        -  모듈들이 하나로 묶여 있기 때문에 버그나 오류를 처리하기 어렵다.
        - 기능상의 작은 결함이 시스템 전체로 확산할 수 있다.
        - 다양한 환경의 시스템 적용하기 어렵다. 수정이 필요한 경우 단일형 구조는 수정하기 어렵다.
- 계층형 구조 커널 : 비슷한 기능을 가진 모듈을 묶어서 하나의 계층으로 만들어서 계층 간 통신을 통해 운영체제 구현 방식, 윈도우 등 오늘날의 운영체제가 대부분 이 구조이다.
    - 장점
        - 단일형에 비해 버그나 오류 쉽게 처리, 오류 발생 시 해당 계층만 수정
        - 디버깅 쉬움
    - 단점
        - 계층이 존재하기 때문에 하나 문제가 생기면 위, 아래 계층이 동작을 못 할 수 있음.
        -  운영체제가 커지고 복잡해지면 많은 계층들이 발생하게 되어서 커널의 크기도 커지고 하드웨어 용량도 늘어남.
- 마이크로 구조 커널 : 프로세스 관리, 메모지 관리, 프로세스 간 통신 관리 등 가장 기본적인 기능만 제공하고 나머지 부분은 사용자 영역에 구현하는 구조이다. 애플의 운영체제 OS X, IOS가 이런 구조이다.
    - 장점
        - 각 모듈은 독립적으로 작동하기 때문에 하나의 모듈이 실패하더라도 전체 운영체제가 멈추지 않는다.
        -  많은 컴퓨터에 이식하기 쉽다.
        -  커널이 가벼워 CPU 용량이 적은 시스템에 적용이 가능하다.
    - 단점
        - 모듈이 독립적으로 존재하여 모듈 간 통신이 빈번하게 이루어져 성능이 저하될 수 있다.

자세한 그림은 : [관련 블로그 참고](https://ardor-dev.tistory.com/22#:~:text=%F0%9F%94%B4%20%EB%8B%A8%EC%9D%BC%ED%98%95%20%EA%B5%AC%EC%A1%B0%20%EC%BB%A4%EB%84%90,%EC%9D%84%20%EA%B5%AC%ED%98%84%ED%95%9C%20%EA%B2%83%EA%B3%BC%20%EA%B0%99%EC%8A%B5%EB%8B%88%EB%8B%A4)


### 커널에 접근, 자신을 보호?

왜 커널에 접근해서 작업을 해야할 지 생각을 해보면, 직접적으로 만약 자원들을 제공을 하면 사용자의 부주의로 인해서 컴퓨터 시스템을 파괴할 수도 있고 모든 과정들을 직접 핸들링 해야하는 불편함이 생긴다.

그래서 어찌보면 편안하게 사용하기 위해서 커널을 이용한다고 보면 될거 같다. 그리고 약간 폭탄이라 보기엔 그렇지만 커널 내부에서 직접 뭔가를 다루는 일은 시한폭탄의 해체 선을 건드리는 작업과 같을 수도 있는 것이다.

계속 길게 말하긴 했지만 **직접 자원을 다루는 것은 위험하니깐 시스템 콜을 이용해 요청만 하고 결과만 기다릴 수 있도록 하게 만든 것이다.**

책에서는 이렇게 설명한다.
> 유저 프로그램이 I/O 요청으로 트랩(trap)을 발동하면 올바른 I/O 요청인지 확인한 후 유저 모드가 시스템콜을 통해 커널 모드로 변환되어 실행된다.

이 예시를 보자.
> fs.readFile()을 파일 시스템의 파일을 읽는 함수인데, 이때 유저 모드에서 파일을 읽지 않고 커널 모드로 들어가 파일을 읽고 다시 유저 모드로 돌아가 그 뒤에 있는 유저 프로그램의 로직을 수행한다.

이 단계에서 유저 모드, 커널 모드 나누었는데

> - 유저 모드 : 유저가 접근할 수 있는 영역을 제한적으로 두고, 프로그램의 자원에 함부로 침범하지 못하는 모드
> - 커널 모드 : 모든 자원(드라이버, 메모리, CPU 등)에 접근, 명령을 할 수 있다. 이른 바 관리자 모드처럼 모든 것을 다 할 수 있는 것이다.

위 예시에서는 시스템 콜을 통해서 함수만 실행을 하면 유저 모드에서 못하는 것을 커널 모드에서 처리한 후 다시 돌아오는 것을 볼 수 있었다.

### 시스템 콜

시스템 콜이 말만 보면 커널과는 전혀 관련 없을 거 같은데 사실 커널 안에는 시스템 콜, 드라이버가 다 내부에 있다. 우선 첫 번째인 시스템 콜부터 알아보자.

> 시스템 콜 : 커널이 자신을 보호하기 위해 만든 인터페이스, 운영체제가 커널에 접근하기 위한 인터페이스, 유저 프로그램이 운영체제의 서비스를 받기 위해 커널 함수를 호출할 때 사용.

커널에 접근하기 위한 인터페이스, 그러면서 자신을 보호하기 위한 것, 그리고 커널 함수를 호출할 때 쓴다. 라고 3가지가 있었다.

시스템 콜은 하나의 추상화 계층이다. 위에 언급했던 것처럼 유저 모드, 커널 모드를 나누고 중간의 중개자 같은 역할을 하는 친구이다. 이 친구가 인터페이스이기 때문에 네트워크 통신, 데이터베이스와 같은 낮은
단계의 영역 처리에 대한 부분을 많이 신경 쓰지 않고 프로그램을 구현할 수 있다.


### 커널 모드, 사용자 모드를 어떤 기준으로 나눌까?

책에서 설명하길 `modebit`라는 플래그 변수로 나눈다고 한다. 예를 들면 카메라, 키보드와 같은 I/O 디바이스는 운영체제를 통해서만 관리를 해야 하는데 왜 그렇냐면 위에서 말한 것처럼 우선 시한폭탄적인 측면과, 공격자가 공격을 했을때 카메라를 직접 켜버릴 수 있기 때문에 그렇다.

그래서 0을 커널모드, 1을 유저 모드로 설정하고 실행한다. 

### 드라이버
> 드라이버 : 하드웨어를 제어하기 위한 소프트웨어

처음 우리가 키보드, 마우스를 설치하게 되면 드라이버라는 것을 설치하게 되는데 왜냐하면 특정 응용프로그램에서 각각의 다른 입출력 장치에 대한 정보를 내장하기 어렵다.

그래서 드라이버를 이용하여 안에 있는 하드웨어 구동 방식과 특성, 기능에 대한 정보를 담아 해당 입출력 장치 제어를 할 수 있게끔 설계를 하였다.

## 컴퓨터 요소

컴퓨터는 크게 CPU, DMA 컨트롤러, 메모리, 타이머, 디바이스 컨트롤러 등으로 이루어져 있다.

### CPU

> CPU(Central Processing Unit):  산술논리연산장치, 제어장치, 레지스터로 구성되어 있는 컴퓨터 장치

이렇게 부르며 인터럽트라는 것에 의해 단순히 메모리에 존재하는 명령어를 해석해서 실행하는 일꾼이다.

책의 그림에서 보면 알겠지만 운영체제가 관리자 역할을 해서 커널모드로 가서 일을 실행하려고 이제 프로그램들을 메모리에 올려 프로세스로 만들면 CPU가 일을 처리하는 방식이다.

### CPU의 제어장치

명령어,데이터의 입출력과 ALU의 동작 제어
- 프로그램/코드/명령어를 해석(해독)하고
- 이의 실행을 위한 제어 신호들을 순차적으로 발생시키며,
- 명령을 읽고 실행하는데 필요한 CPU 내부의 각 장치 간의 데이터 흐름을 제어


### CPU의 레지스터
- CPU에 내장되어, 데이터를 일시적으로 보관하는 임시 기억장치

여기서 레지스터는 뒤에도 언급하겠지만 매우 빠른 임시기억장치이다. 

매우 빠르다고 하였는데 메모리보다 연산 속도가 수십 배에서 수백 배까지 빠르게 된다. CPU에는 따로 데이터를 저장할 방법이 없기 때문에 레지스터를 거쳐 데이터를 전달한다.


### CPU의 산술논리연산장치
- 산술논리연산장치(ALU)라고도 불리는데 덧셈, 뺄셈 같은 두 숫자의 산술 연산과 배타적 논리합, 논리곱 같은 논리 연산을 계산하는 디지털 회로이다.

### 이를 통한 CPU 연산 처리 과정
제어장치, 레지스터, ALU를 통해 연산을 어떻게 할까?

1. 제어장치가 메모리에 계산할 값을 로드하고, 레지스터에도 로드한다.
2. 제어장치가 레지스터에 있는 값을 계산하라고 ALU에 명령한다.
3. 제어장치가 계산된 값을 다시 '레지스터에서 메모리로' 계산한 값을 저장한다.


### 인터럽트?

> 인터럽트 : CPU가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치에 예외상황이 발생하여 처리가 필요할 경우에 CPU에게 알려 처리할 수 있도록 하는 것
우선적으로 처리해야할 일이 발생하였을 때 그것을 처리하고 원래 동작으로 돌아옴

인터럽트가 발생하게 되면 인터럽트 핸들러 함수가 모여 있는 인터럽트 벡터로 가서 인터럽트 핸들러 함수가 실행된다.

> - 인터럽트 벡터 : 여러가지 인터럽트에 대한 해당 인터럽트 발생시 처리해야 할 루틴의 주소를 보관하고 있는 테이블
> - 인터럽트 핸들러 : 실체 인터럽트를 처리하기 위한 루틴
> - 인터럽트 핸들링 : 인터럽트가 발생한 경우에 처리해야 할 일의 절차를 인터럽트 핸들링
> - 인터럽트 처리루틴 : 인터럽트로 인해 실제로 수행해야 되는 할일을 프로그래밍 해둔것.


이런 과정을 수행해 루틴을 찾아서 그 일을 하면 인터럽트가 해결된다고 한다.


그래서 크게 하드웨어, 소프트웨어 인터럽트로 나뉜다고 한다. 

### 하드웨어 인터럽트

주로 IO 디바이스에서 발생하는 인터럽트를 말한다. 

이때 인터럽트 라인이 설계된 이후 순차적인 인터럽트 실행을 중지하고 운영체제에 시스템콜을 요청해서 원하는 디바이스로 향해가서 디바이스에 있는 작은 로컬 버퍼에 접근해 일을 수행한다.

> - 인터럽트 라인 : CPU 옆에 있는 인터럽트 감지기
> - 로컬 버퍼 : 각 장치마다 제어하기 위해 설치된 장치 컨트롤러에서 장치로부터 들어오고 나가는 데이터를 임시로 저장하기 위한 작은 메모리

> 출처 : [버퍼 관련](https://velog.io/@sparkbosing/%EB%A1%9C%EC%BB%AC-%EB%B2%84%ED%8D%BC), [인터럽트 관련](https://primayy.tistory.com/43)
### 소프트웨어 인터럽트
소프트웨어 인터럽트를 trap, exception이라고도 부른다. 프로그램의 오류로 인해 발생하는 인터럽트다. 프로세스 오류도 있고 프로세스가 시스템콜을 호출할 때 발동된다.


자세한 사항은 : [소프트웨어 인터럽트 관련](https://doh-an.tistory.com/31)



### DMA 컨트롤러 

> DMA(Direct Memory Access) : I/O 디바이스가 메모리에 직접 접근할 수 있도록 하는 하드웨어 장치를 뜻한다.

이렇게 직접 접근하게 하는 이유는 CPU에 너무 많은 장치들이 들어오게 되면 인터럽트 요청도 많이 들어와서 CPU가 부하를 일으킬 수 있기 때문에 그것을 방지차 CPU의 일을 도와주는 보조 일꾼처럼 보면 될 거 같다.

그리고 CPU와 DMA 컨트롤러가 동시에 일을 하는 것을 방지한다.

**DMA의 특징**을 보면 다음과 같다. 
- 프로그램 수행 중 인터럽트의 발생 횟수 최소화 및 시스템 효율성 증대

- CPU는 DMA 컨트롤러와 상태정보 및 제어정보만 전송

- CPU의 개입 없이 입출력장치와 주 기억장치와의 데이터 직접 전송 가능


### 메모리
메모리에 대한 내용은 방대할 거다. 그치만 이 챕터에서는 개념만 알고 가는 것으로만 일단 하자.

> 메모리 : 전자회로에서 데이터나 상태, 명령어 등을 기록하는 장치를 말하며 RAM(Random Access Memory)를 일컬어 메모리라고 부른다. 

그래서 역할 분리를 해보자면 -> CPU : 계산,  메모리 : 계산한 걸 기억

CPU가 일꾼이고 메모리가 작업장이기에 많은 일들을 동시에 하고 싶으면 메모리가 커지면 된다.


### 타이머
> 타이머 : 몇 초 안에 작업이 끝나야 한다는 것을 정하고 특정 프로그램에 시간 제한을 다는 역할을 한다.

### 디바이스 컨트롤러
> 디바이스 컨트롤러 : 컴퓨터와 연결되어 있는 IO 디바이스들의 작은 CPU를 말한다.



### 출처
- [운영체제 관련](https://ardor-dev.tistory.com/22#:~:text=%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EB%8A%94%20%EC%BB%A4%EB%84%90%EA%B3%BC%20%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4,%EC%9D%98%20%EC%97%94%EC%A7%84%EC%97%90%20%ED%95%B4%EB%8B%B9%ED%95%9C%EB%8B%A4.)
- [커널 관련](https://blockdmask.tistory.com/69)
- [커널 종류 관련](https://ardor-dev.tistory.com/22#:~:text=%F0%9F%94%B4%20%EB%8B%A8%EC%9D%BC%ED%98%95%20%EA%B5%AC%EC%A1%B0%20%EC%BB%A4%EB%84%90,%EC%9D%84%20%EA%B5%AC%ED%98%84%ED%95%9C%20%EA%B2%83%EA%B3%BC%20%EA%B0%99%EC%8A%B5%EB%8B%88%EB%8B%A4)
- [인터럽트 관련](https://doh-an.tistory.com/31)
- [버퍼 관련](https://velog.io/@sparkbosing/%EB%A1%9C%EC%BB%AC-%EB%B2%84%ED%8D%BC)
- [인터럽트 관련](https://primayy.tistory.com/43)

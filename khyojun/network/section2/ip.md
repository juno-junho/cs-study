## IP 주소


### ARP

일단 알아야 할게 우리가 솔직히 통신할 때 맨날 IP IP 거리지만 실제로는 IP주소에서 ARP를 통하여서 MAC 주소를 찾아서 그 기반으로 통신을 한다고 한다.

그래서 ARP(Address Resolution Protocol)이란 IP 주소로부터 MAC 주소를 구하는 IP 와 MAC 주소의 다리 역할을 하는 프로토콜이다.

IP -> ARP -> MAC


MAC -> RARP -> IP 이런 식이다.

예시를 들어보면 A라는 장치와 B,C,D라는 장치가 있다고 했을 때 A가 B랑 통신하기 위해서 ARP Request **브로드캐스트**라는 과정을 거치게 된다. 

그리고 장치 B가 A에게 ARP reply **유니캐스트**라는 과정을 거쳐서 IP주소에 맞는 MAC 주소를 찾게 된다.

> - 브로드캐스트 : 송신 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전송되는 방식 
> - 유니캐스트 : 고유 주소로 식별된 하나의 네트워크 목적지에 1:1로 데이터를 전송하는 방식

---

### 홉바이홉 통신

IP 주소를 통해서 통신하는 과정을 홉바이홉 통신이라고 부른다. 여기서 hop이란 영어 뜻 자체로 뛰어넘는다는 의미를 가진다.

이것을 통신망에서 각 패킷이 여러 개의 라우터를 건너가는 모습을 비유적으로 표현한 것이라고 생각하면 좋을 거 같다. 

통신 장치에 있는 '라우팅 테이블'의 IP를 통해 시작 주소부터 시작하여 다음 IP로 계속해서 이동하는 '라우팅'과정을 거쳐 패킷이 최종 목적지까지 도달하는 통신을 말한다.

> 라우팅 : IP 주소를 찾아가는 과정

### 라우팅 테이블

> 라우팅 테이블 : 라우터에 들어가 있는 목적지 정보들과 그 목적지로 가기 위한 방법이 들어 있는 리스트를 뜻한다.


### 게이트웨이

> 게이트웨이 : 서로 다른 통신망, 프로토콜을 사용하는 네트워크 간의 통신을 가능하게 하는 관문 역할을 하는 컴퓨터나 소프트웨어를 두루 일컫는 용아

게이트웨이는 A와 B라는 다른 네트워크가 있을때 이 둘 사이의 서로 다른 네트워크상의 통신 프로토콜을 변환시켜주는 역할을 한다고 생각하면 좋다.

다른 네트워크로 가기위한 관문이라고 생각하면 좋을거 같다.



---

### IP 주소 체계

IP 주소라는 것은 2가지 IPv4, IPv6라는 방식으로 나뉘게 된다.

> - IPv4 : 32 비트를 8비트 단위로 점을 찍어 표기
> - IPv6 : 64 비트를 16비트 단위로 점을 찍어 표기하는 방식

그러나 현재에는 IPv4를 많이 사용하지만 추세는 IPv6를 향하고 있는데 왜 많이 사용하지 않을까? 왜?

### 왜? 아직 IPv4를 IPv6보다 많이 사용할까?

아직이라는 말이 중요한데 이제 조금 더 있으면 IPv4방식으로 사용하는 방식으로는 주소가 부족해지는 현상이 발생될 수도 있다. 그러나 그런 문제를 해결하기 위하여서 IPv6를
이용하여 주소를 늘리는 방식인데 그러면 보안도 좋아지고 좋은게 아닐까? 왜 아직 상용화가 되지 않았을까?

그 이유는 IPv4에서 IPv6로 업그레이드를 해야하는 상황이나 아직 개개인에게는 그렇게 IP주소를 늘릴 만큼의 상황은 아니기 때문이다. 그리고 바뀌게 되면 아직은 불편한 점이 많기 때문이라고 한다.


### IPv4 vs IPv6

> 추가적인 차이점은 아래 링크를 들어가서 표를 확인해보면 좋을 거 같다. 
> - https://www.guru99.com/difference-ipv4-vs-ipv6.html

### 출처

- https://dany-it.tistory.com/57
- https://nordvpn.com/ko/blog/ipv4-ipv6-bigyo/



### 클래스 기반 할당 방식

옛날에는 이 방식을 사용하였지만 사용하는 주소보다 버리는 주소가 많아서 현재에는 다른 방식으로 IP를 할당한다.

### 클래스 기반 할당 방식을 어쩌다 사용했나?

각각의 규모에 딱 알맞게 IP를 할당할 수 없었기 때문에 일정 규모의 IP를 쪼개어놨다가 할당하는 방식으로 사용하였다고 한다.

어떤 형식으로 각 클래스를 할당할 수 있는지 확인해보자.


### 할당 방식

앞에 있는 IP주소를 네트워크 주소, 그 뒤를 컴퓨터에 부여하는 주소인 호스트 주소로 놓고 사용을 한다.
그것을 이제 반씩 나눠서 클래스를 나누게 된다.

> 예시로 보게 되면 4비트짜리를 반으로 쪼개 보겠다.
>0000~1111 을 반으로 쪼개려면 최상위 비트만 변경해서 반으로 나누면 된다. 
> - 0000 ~ 0111 8개
> - 1000 ~ 1111 8개

그래서 보면 A4,A3,A2,A1 으로 종이를 나누는 것과 비슷한 방식이다.

이것을 클래스 할당에 적용해보자.
> - A 클래스 : 0
> - B 클래스 : 10
> - C 클래스 : 110
> - D 클래스 : 1110
> - E 클래스 : 1111

이런 식으로 나뉘게 된다. 이런 클래스를 담당하는 쪽을 네트워크 주소, 호스트 주소로 나뉘게 되는데 이 중 A,B,C는 일대일 통신에 사용이 되어지고, D클래스는 멀티캐스트, E클래스는 앞으로 사용할 예비용으로
쓰는 방식이다.

### 단점

그런데 이렇게 되면 단점이 명확하다. 만약 예를 들면 C클래스를 할당 받아서 192.193.194.0라고 하였을때 그 사용자가 100명이게 되면?

254-100 = 154개의 IP가 낭비된다는 측면이 있게 된다. 그래서 이를 해결하기 위해서 DHCP, IPv6, NAT라는 것이 나오게 된다. 

> 참고 : https://jhnyang.tistory.com/503

### DHCP

> DHCP : IP 주소 및 기타 통신 매개변수를 자동으로 할당하기 위한 네트워크 관리 프로토콜입니다.

즉, 간단히 말해서 인터넷에 연결할 때마다 IP 주소를 할당할 수 있도록 도와주는 친구이다. 

그래서 많은 라우터와 게이트웨이 장비에 DHCP 기능이 있어서 대부분 가정용 네트워크에서 IP주소를 할당시켜준다.


### NAT

> NAT(Network Address Translation) : 패킷이 라우팅 장치를 통해 전송되는 동안 패킷의 IP 주소 정보를 수정하여 IP 주소를 다른 주소로 매핑하는 방법
아까 말했듯이 IPv4라는 체계로는 많은 주소들을 감당하지 못한다는 단점을 보완하기 위해서 생긴 것인데, NAT를 이용해서 공인 IP, 사설 IP 나눠서 많은 주소를 처리한다.
이것을 가능하게 해주는 소프트웨어로 ICS, RRAS, Netfilter 등이 있다.

이런 설명들을 보면 딱딱해서 바꿔보자면 우리가 사용하는 공유기안에 NAT기능이 탑재되어있는데 이런 예시들을 생각해보자.

예를 들어 우리의 사설 IP 가 외부의 네트워크로 노출이 되면 보안상 상당히 위험할 것이다. 그러면서 한 공유기에 많은 PC가 접속하는 환경인데 사설IP 로 나간다면 IP 주소를 할당하는 입장에서도 되게 많이 할당해야하므로 
효율적이지 못한 상황이다. 그래서 이렇게 하는 것으로 한다.

> a,b,c,d 라는 사설 ip 주소 -> nat -> e라는 주소로 변형 -> 목적지로 전송 이때 변형하게 되면 원래의 사설 주소는 nat테이블에 저장해놓고 다시 돌아올 경우 이 테이블을 참조 후 사설 IP로 변형하여 보내준다.


위에 예시를 보면 5개를 1개의 ip주소로 할당하여서 보내주니까 자원적으로도 효율적이다. 

### NAT 단점

그렇지만 NAT도 여러 명이 동시에 인터넷을 접속하게 되어서 실제 접속하는 호스트 숫자에 따라서 접속 속도가 느려질 수 잇다는 단점이 있다.

그래서 우리가 한 공유기에 사람들 몰리면 많이 느려지는거 같다. 




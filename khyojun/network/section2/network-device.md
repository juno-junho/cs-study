## 네트워크 기기

### 네트워크 기기의 처리 범위
- 애플리케이션 계층 : L7 스위치
- 인터넷 계층 : 라우터, L3 스위치
- 데이터 링크 계층 : L2 스위치, 브리지
- 물리 계층 : NIC, 리피터, AP

여기서 상위 계층을 처리하는 장치는 그 계층의 하위 계층들도 처리할 수 있다. 그렇지만 그 반대는 되지 않는다.



우리가 우선 이 책의 내용을 보기 전에 알아야 할 내용과 용어들이 있다. 그것부터 알아보고 가자.


### 허브

> Hub : 중심지라는 뜻이다. 중앙 집중이라는 뜻을 내포한다.

▶ 허브란 다수의 PC와 장치들을 묶어서 LAN을 구성할때 사용하는 기기이다.

- 랜선은 하나고 연결할 컴퓨터는 여러대일경우 사용하며, 거리가 가까운곳의 컴퓨터들을 연결하는 역할을 한다.

- 허브는 크게 1.멀티포트 2.리피터 기능 역할로 많이 사용된다.

1. 멀티포트 : 공유기 포트가 부족하면 허브를 추가적으로 설치하여 포트를 늘린다.

2. 리피터 기능

- UTP 케이블의 경우 케이블 거리가 100M가 넘을경우 신호 감쇠현상이 발생한다.

100M 거리가 넘는 두 컴퓨터 사이에 허브를 설치하여 네트워크 신호를 증폭시킴으로써 신호 감쇠현상을 감소
시킬수 있다. 이러한 기능이 리피터 기능이며, 의미는 데이터를 재전송한다는 뜻이다.

하지만 허브에는 치명적인 단점이 있다.

예를 들어 전송대역이 10Mbps인 라인에 허브를 연결하고 그 허브에 컴퓨터 5대를 연결했을 경우 각각의
컴퓨터 전송대역은 10/5=2Mbps 속도가 됩니다. 즉, 속도를 나눠 갖는다고 한다. 그 만큼 만약 컴퓨터들이 엄청 몰리는 병목현상이 생겨버리면 속도가 엄청 느려진다는 단점이 있다.

정리해보자면 허브는 다수의 PC와 장치들을 묶어서 LAN(근거리 통신망)을 구성할때 사용하는 것인데 허브에서는 패킷을 받는 상황속 모든 장치들에게 다 보내주기 때문에
사용하는 PC가 많아지는 경우 굉장히 속도가 느려지는 상황이 나오게 된다.


그래서 나온 것이?

### 스위치

>스위치(switch)는 네트워크 회선과 서버컴퓨터를 연결하는 네트워크 장비이다.

스위치는 허브보다는 똑똑한 친구이다. 왜냐하면 무작위로 모든 장치에 보내지 않기 때문이다.

- 스위치는 연결된 장비들의 IP와 MAC주소를 모두 가지고 있다.
- 허브에서의 과정과는 다르게 자기가 알고있는 목적지에 해당하는 곳으로만 보내준다.
- 하지만, 본인이 모르는 주소의 패킷을 전달받으면 허브의 경우처럼 모든 장치에 다 전달해버린다.


### 라우터
> 라우터는 네트워크를 통해 데이터를 주고받을 때 데이터에 담긴 수신처의 주소를 읽고 가장 적절한 통신통로를 이용해 다른 통신망으로 전달해주는 장치이다.

라우터는 최적의 길을 지정하는 네비게이션 같은 친구이다. (최적의 경로 : 가장 빠른 길)

ROUTE : 길이라는 영어에서 파생된 단어이다. 

라우터는 위 설명한 장치들보다 더 똑똑한 친구이다. 

- 자신에게 연결된 디바이스들의 주소를 가지고 있다.
- 네트워크 상에 자신과 연결된 가장 가까운 라우터의 주소도 가지고 있다.

기타 더 많은 기능들을 가지고 있다. 간단하게만 일단 말하면 라우터를 이용하여 내부의 네트워크가 아닌 외부의 네트워크와도 통신을 할 수 있기 때문에 엄청 중요한 친구이다.


### 게이트웨이

> OSI 모델의 모든 계층을 포함하여 동작하는 네트워크 장비입니다. 두개의 완전히 다른 네트워크 사이의 데이터 형식을 변환하는 장치이다.





### L1,2,3,4,5,6,7 에 대하여

- L1  스위치 (허브, 더미 허브): 가장 하위 계층인 1계층(물리 계층)에서 작동하는 친구이다. 이 허브라는 친구를 L1 스위치라고 한다.
- L2 스위치 (스위칭 허브) : 가장 흔히 볼 수 있는 스위치인 L2 스위치는 2계층(데이터 링크 계층)에서 작동하며, 보통 스위칭 기능이 있는 스위칭 허브를 사용한다.
> 스위칭 허브란, 자신에게 꽂혀있는 모든 장비에게 데이터를 전달하는 허브와는 달리 각 장비의 MAC 주소를 내부적으로 저장하고 있기 때문에, 들어온 패킷의 MAC 주소를 읽어 해당하는 장비를 찾아 전달해주는 장비를 뜻한다.

L2(2계층)는 MAC 주소와 밀접한 관련이 있다는 것을 떠올리며
'그래서 스위칭 허브를 사용하는구나'하고 연관 지을 수 있다.

다른 방식에 비해 저렴하면서 성능은 높고 간단한 구조와 신뢰성이 높다는 장점이 있지만,
패킷에 의해 성능 저하가 발생하는(즉, 라우팅이 불가능한) 단점이 있다.

- L3 스위치 (라우터, 공유기) : 보통 3계층(네트워크 계층)은 라우팅 기능을 하는 층으로, 라우터는 네트워크 패킷을 연결해주는 통로 역할을 하며 대역폭 확장이 주 기능이다.
    - MAC주소와 IP주소까지 알 수 있다.
    - L2에서 라우팅 기능이 추가되었다.
    - 가정에서 많이 사용하는 공유기도 L3 기능과 WIFI 기능을 포함하고 있다. 보통 이러한 공유기를 AP 장비라고도 부르기도 한다.
  
- L4 스위치 : 4계층(전송 계층)은 외부에서 들어오는 모든 요청을 먼저 받아들이는 계층이다.

>여기서 L4 스위치가 활약을 하는데, 그러한 요청들을 먼저 받아 내부의 서버들에게 적절히 분산시켜준다.
즉, L4 스위치의 주요 역할은 여러 대의 서버를 한 대처럼 묶을 수 있는 부하 분산(로드 밸런싱) 기능을 제공하는 것이다.
프로토콜을 기반으로 하여 애플리케이션 별로 우선순위를 두어 스위칭을 한다, 이 말이다.
그래서 L4 스위치는 IP 주소뿐만 아니라 Port 정보도 참고한다.



예를 들어, 웹 서비스를 하나 만들었는데,
공인 IP(125.125.12.5)를 갖고 있는 웹 서버 한대로 모든 요청을 처리한다고 가정하자.
사용자가 늘어남에 따라 트래픽이 감당이 안되어 서버를 증설했는데,
해당 서버의 IP는 125.125.12.6이다.

그럼 우리의 웹 서비스를 이용하는 사용자들에게
125.125.12.5 서버 말고 125.125.12.6 서버로도 접속해달라고 공지를 올려야 할까?

전혀 아니다.


이럴 때 필요한 것이 로드 밸런싱(부하 분산)으로,
사용자들에게 요청할 필요도 없고 일일이 서버에게 요청을 전달할 필요도 없다.
당연히 보안성은 말할 것도 없이 좋다.

이러한 훌륭한 기능을 하는 L4 스위치는,
하나의 서버가 죽어 서비스가 중단되는 경우 다른 서버로 해당 서비스를 대체하는
ACTIVE-ACTIVE / ACTIVE-STANDBY 기능도 한다.

하지만 설정이 많이 복잡하다는 단점이 있다.



L7 스위치 (L5 스위치, L6 스위치) : 보통 L7 스위치가 L5, L6 기능까지 같이 하기 때문에 L7 스위치 하나만 알면 된다.

애플리케이션 영역인 7계층(응용 계층) 역시 4계층처럼
일반적으로 스위치로 들어온 패킷을 적절한 서버로 전송해주는 로드 밸런싱을 위해 스위치를 사용하는데,
L4 스위치와는 차이가 있다.

먼저, L4 스위치의 경우 3~4계층에 속하는 IP 주소 및 TCP/UDP Port 정보를 보고 스위칭하지만,
L7 스위치의 경우 3~7계층에 속하는 IP 주소 및 TCP/UDP Port 정보, 패킷 내용까지 모두 보고 스위칭해주는 장비이다.


또한, L4 스위치의 경우 TCP/UDP Port를 이용하여 로드 밸런싱(트래픽 분산처리)을 하지만,
L7 스위치의 경우 7계층 HTTP의 URL, FTP 쿠키 정보 및 바이러스 패턴을 분석하여
보안에 더 유리하고 정교한 로드 밸런싱이 가능하다(ex. Traffic filter, Security, VPN 등).
그래서 L7 스위치를 보안 스위치라고 부르기도 한다.


일단 이정도만 알고 그다음 이제 책으로 넘어가서 읽어보자.

---

### 애플리케이션 계층을 처리하는 기기

대표적으로는 L7스위치가 있다고 하는데 스위치가 어떤 역할인가?

> 여러 장비를 연결하고 데이터 통신을 중재하며 목적지가 연결된 포트로만 전기 신호를 보내 데이터를 전송하는 통신 네트워크 장비이다.

여기서 L7 스위치는 이런 역할을 한다.
- 로드 밸런서의 역할 : 서버의 부하를 분산하는 기기이다.
- 클라이언트에게 들어오는 요청을 뒤쪽의 여러 서버로 나누는 역할을 한다. -> 처리할 수 있는 트래픽을 증가시킨다.
- URL, 서버, 캐시, 쿠키들을 기반으로 트래픽을 분산시킨다.
- 바이러스, 불필요한 외부 데이터 등을 걸러내는 **필터링** 기능을 가지고 있다.
- 장애가 일어난 경우, 정기적으로 헬스 체크(health - check): 건강검진 기능을 한다. 그래서 트래픽 분산 대상에서 제외를 시킨다.


### L4, L7스위치의 차이

여기서 자꾸 L4, 7 2 3 이런 숫자들이 올건데 이건 레벨 이라고 딱 생각하면 너무 좋을 거 같다.

여기서 L4, L7 둘 다 로드밸런서의 역할을 한다. 서버의 부하를 분산하기 위한 기기라는 뜻이다. 그런데 어떤 차이점이 있냐면
- L4스위치는 전송 계층을 처리하는 기기로 스트리밍 관련 서비스에서는 사용할 수 없어서 메시지를 기반으로 인식을 못한다.
- IP와 포트(특히 포트 기반)으로 트래픽을 분산시킨다. 
- L7 스위치는 IP, 포트 말고도 URL, HTTP 헤더, 쿠키 등을 기반으로 트래픽을 분산시킨다. 


* 참고 : 클라우드 서비스에서 L7을 이용한 로드밸런싱은 ALB(Application Load Balancer) 컴포넌트, L4를 이용한 로드밸런싱은 NLB(Network Load Balancer) 라고 한다.



### 헬스 체크
>헬스 체크는 전송 주기와 재전송 횟수 등을 설정한 이후 반복적으로 서버에 요청을 보내는 것을 말합니다.

L4, L7도 이 기능을 가지고 있다. 그런데 우리가 건강검진 하듯이 이 헬스 체크도 요청을 적당히 해야지 너무 많이 하면 서버에 부하가 되니 잘 조절하면서 해야 한다.

보내는 방식이 TCP, HTTP 등등 다양한 방법으로 요청을 보내며 정상적으로 서버가 되고 있는지 확인한다고 한다.

### 로드 밸런서가 어떤 역할을 해줬나?

로드밸런서라고 하는데 위에서 말한 것처럼 서버들에게 분산을 시켜주는 기기라고만 말을 했었다. 이렇게 되면 서버의 이중화가 가능해지는데 이러면 한 서버가 고장이 나더라도 다른 서버를 통해서
서비스를 운용을 할 수가 있게 된다. 

그래서 책에서는
> 로드밸런서는 2대 이상의 서버를 기반으로 가상 IP를 제공하고 이를 기반으로 안정적인 서비스를 제공합니다.

라고 말한다. 예시를 들자면 0.0.12010이라는 가상 IP에 사용자들이 접근을 하고 사용 가능한 서버인 0.0.12011, 0.0.12012가 있다고 했을 때
0.0.12011에 문제가 생긴다면 0.0.12012 서버를 기반으로 서비스를 운용하게 하는 것이다.


---

### 인터넷 계층 처리 기기

### 라우터
> 라우터는 여러 개의 네트워크를 연결, 분할, 구분시켜주는 역할을 한다. 

이렇게 책에서는 설명하며 서로 데이터를 주고받을 때 패킷 소모를 최소화하고 경로를 최적화하여 최소 경로로 패킷을 포워딩하는 라우팅 장비라고 한다.

쉽게 말해서 ROUTE: 길 을 찾아주는 네비게이션과 같은 역할이다. 그것도 가장 빠른 길을 찾아주는 것이다. 

### L3 스위치

L3 스위치란 L2 스위치의 기능과 라우팅 기능을 갖춘 장비를 말한다. 일단 L2는 L3보다 수준이 낮을거다. 위에서 말한 것처럼 숫자가 낮기 때문에...

그래서 실제로는 L3 스위치를 라우터라고 해도 무방하다고 한다. 라우터가 소프트웨어 기반, 하드웨어 기반으로도 나눠지는데 여기서 말하는 L3스위치는 그것 중 하드웨어 기반의 라우팅을 담당하는 장치라고 한다. 

---

### 데이터 링크 계층을 처리하는 기기 

데이터 링크를 처리하는 기기로는 L2 스위치, 브리지라고 한다.

### L2 스위치

>L2 스위치는 장치들의 MAC 주소를 테이블을 통해 관리하여, 연결된 장치로부터 패킷이 왔을 때 패킷 전송을 담당한다.

- IP 주소 기반으로 라우팅을 하지 못한다. 못 알아듣기 때문에
- 단순히 패킷의 MAC주소를 읽어 스위칭하는(연결) 역할을 한다.
- 목적지에 MAC주소가 없다면 전체 포트에 전달한다.
- MAC주소 테이블의 주소는 일정 시간 이후에 삭제하는 기능을 가지고 있다.

### 브리지

>포트와 포트 사이의 다리 역할을 하는 친구이다. 

다리 역할을 한다는 말이 통신망 범위를 확장하고 서로 다른 LAN등으로 이루어진 '하나의' 통신망을 구축할 때 쓰이는 것이다.

그리고 다음과 같은 기능을 가지고 있다.

- 물리 계층 및 데이터 링크층(MAC계층)의 연결기능을 제공합니다.

- 네트워크를 분리하는 기능을 담당하고, 또 서로 다른 네트워크를 연결해주기도 합니다.

- 리피터보다 지능적이며 리피터의 기능을 모두 갖고 있습니다.

---

### 물리 계층 처리하는 기기 

대표적으로 NIC, 리피터, AP가 있다. 

### NIC

LAN 카드라고 부르며 네트워크 인터페이스 카드(NIC)는 2대 이상의 컴퓨터 네트워크를 구성하는 데 사용하며 컴퓨터 내에 설치하는 확장 카드이다.

여기서 중요! **LAN 카드에는 주민등록번호처럼 각각을 구분핳기 위한 고유의 식별번호인 MAC 주소가 있다.**

### 리피터

리피터는 들어오는 신호 정도를 증폭하여 다른 쪽으로 전달하는 장치를 말합니다.(강조하는 느낌)

이를 통해서 패킷이 더 멀리 전달 될 수 있다. 그런데 광케이블이 보급이되어서 현재는 잘 안 쓰인다고 한다.


### AP

AP는 패킷을 복사하는 기기입니다.(공유기)

AP에 유선 LAN을 연결한 후 다른 장치에서 무선 LAN 기술을 사용하여 무선 네트워크 연결을 할 수 있다. 










### 참고 링크
- 스위치 관련 : https://siahn95.tistory.com/entry/Network%EC%9E%A5%EB%B9%84-L1-L2-L3-L4-L5-L6-L7-%EC%8A%A4%EC%9C%84%EC%B9%98%EB%9E%80
- 허브, 스위치, 라우터 관련 : https://okimaru.tistory.com/2